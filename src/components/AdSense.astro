---
// Optimized Google AdSense ad placement component with multiple unit support
interface Props {
  slot?: string;
  format?: "auto" | "rectangle" | "horizontal" | "vertical" | "autorelaxed";
  responsive?: boolean;
  type?: "display" | "article" | "feed" | "multiplex";
}

const {
  slot = "1134908297", // Default to Display Ad #1
  format = "auto",
  responsive = true,
  type = "display",
} = Astro.props;
---

<div class="adsense-container" data-ad-type={type}>
  <ins
    class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-1720101320139769"
    data-ad-slot={slot}
    data-ad-format={format}
    data-full-width-responsive={responsive ? "true" : "false"}
  ></ins>
</div>

<script>
  function initAds() {
    try {
      const ads = document.querySelectorAll('.adsbygoogle:not([data-adsbygoogle-status])');
      if (ads.length > 0 && (window as any).adsbygoogle) {
        ((window as any).adsbygoogle).push({});
      }
    } catch (e) {
      console.error('AdSense initialization error:', e);
    }
  }

  // Initialize ads on page load and transitions
  document.addEventListener('astro:page-load', () => {
    setTimeout(initAds, 100);
  });
  
  // Initial page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initAds, 100);
    });
  } else {
    setTimeout(initAds, 100);
  }
  
  // Also watch for new ads being added
  const observer = new MutationObserver((mutations) => {
    const hasNewAds = mutations.some(mutation => 
      Array.from(mutation.addedNodes).some((node: any) => 
        node.classList?.contains('adsbygoogle') || 
        (node.querySelector && node.querySelector('.adsbygoogle'))
      )
    );
    if (hasNewAds) {
      setTimeout(initAds, 100);
    }
  });
  
  observer.observe(document.body, { childList: true, subtree: true });
</script>

<style>
  .adsense-container {
    margin: 2rem 0;
    min-height: 250px;
    text-align: center;
  }
  
  .adsense-container[data-ad-type="multiplex"] {
    min-height: 400px;
  }
  
  .adsbygoogle {
    display: block;
  }
</style>
